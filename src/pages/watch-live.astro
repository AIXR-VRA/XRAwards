---
/**
 * Watch Live Page
 * URL: /watch-live
 * Embedded livestream for the XR Awards ceremony
 */
export const prerender = true;

import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import CTAFooter from '../components/CTAFooter.astro';
import { Image } from 'astro:assets';
import { supabase } from '../utils/supabase';

// Fetch active event details
const { data: eventDetails } = await supabase
  .from('event_details')
  .select('*')
  .eq('is_active', true)
  .single();

// Fetch sponsors for the active event
const { data: sponsors } = await supabase
  .from('sponsors')
  .select(`
    id,
    name,
    logo_url,
    sort_order,
    sponsor_events!inner(event_id)
  `)
  .eq('sponsor_events.event_id', eventDetails?.id)
  .eq('is_visible', true)
  .order('sort_order', { ascending: true });

const hasLivestream = eventDetails?.livestream_link;

// Function to convert video URL to embed format
function getEmbedUrl(url: string): string {
  if (!url) return '';
  
  // YouTube conversion
  if (url.includes('youtube.com/watch?v=')) {
    const videoId = url.split('watch?v=')[1].split('&')[0];
    return `https://www.youtube.com/embed/${videoId}?autoplay=0&rel=0`;
  } else if (url.includes('youtu.be/')) {
    const videoId = url.split('youtu.be/')[1].split('?')[0];
    return `https://www.youtube.com/embed/${videoId}?autoplay=0&rel=0`;
  }
  // Vimeo conversion
  else if (url.includes('vimeo.com/')) {
    const videoId = url.split('vimeo.com/')[1].split('?')[0];
    return `https://player.vimeo.com/video/${videoId}?autoplay=0`;
  }
  // Twitch conversion
  else if (url.includes('twitch.tv/')) {
    const channel = url.split('twitch.tv/')[1].split('?')[0];
    return `https://player.twitch.tv/?channel=${channel}&parent=${new URL(import.meta.env.SITE || 'https://xrawards.aixr.org').hostname}`;
  }
  
  // Return URL as-is if it's already an embed or unknown format
  return url;
}

const embedUrl = hasLivestream ? getEmbedUrl(eventDetails.livestream_link) : '';
---

<Layout
  title="Watch Live - AIXR XR Awards"
  description={`Watch the ${eventDetails?.event_name || 'XR Awards'} ceremony live. Join us as we celebrate excellence in virtual and augmented reality.`}
>
  <Header />

  <main class="min-h-screen bg-white">
    <!-- Hero Section with Livestream -->
    <section class="relative bg-[#0E1022] pt-32 md:pt-40 pb-12 md:pb-16 overflow-hidden">
      <!-- Decorative Background Rings -->
      <div class="absolute -left-20 md:left-0 top-1/4 -translate-y-1/2 -translate-x-1/2 w-[300px] h-[300px] md:w-[450px] md:h-[450px]">
        <div class="absolute inset-0 rounded-full" style="background: linear-gradient(180deg, #E91E8C 0%, #5D1635 100%);"></div>
        <div class="absolute top-[55px] left-[55px] right-[55px] bottom-[55px] md:top-[75px] md:left-[75px] md:right-[75px] md:bottom-[75px] rounded-full bg-[#0E1022]"></div>
      </div>
      <div class="absolute -right-20 md:right-0 top-3/4 -translate-y-1/2 translate-x-1/2 w-[300px] h-[300px] md:w-[450px] md:h-[450px]">
        <div class="absolute inset-0 rounded-full" style="background: linear-gradient(180deg, #00D4D8 0%, #0A4B52 100%);"></div>
        <div class="absolute top-[55px] left-[55px] right-[55px] bottom-[55px] md:top-[75px] md:left-[75px] md:right-[75px] md:bottom-[75px] rounded-full bg-[#0E1022]"></div>
      </div>

      <!-- Content -->
      <div class="relative z-10 max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-8">
          <h1 class="page-title text-white mb-6">
            Watch the {eventDetails?.event_year || '2025'} XR Awards Live
          </h1>

          <!-- Decorative Dots -->
          <div class="flex justify-center gap-2 mb-6">
            <span class="w-1.5 h-1.5 rounded-full bg-cyan-400"></span>
            <span class="w-1.5 h-1.5 rounded-full bg-cyan-400"></span>
            <span class="w-1.5 h-1.5 rounded-full bg-cyan-400"></span>
            <span class="w-1.5 h-1.5 rounded-full bg-cyan-400"></span>
            <span class="w-1.5 h-1.5 rounded-full bg-cyan-400"></span>
          </div>

          <p class="page-subtitle text-white">
            {eventDetails?.awards_ceremony ? new Date(eventDetails.awards_ceremony).toLocaleDateString('en-GB', { weekday: 'long', day: '2-digit', month: 'long', year: 'numeric' }) : 'Tuesday, 09 December 2025'} â€¢ {eventDetails?.location || 'Brussels, Belgium'}
          </p>
        </div>

        <!-- Livestream Embed or Placeholder -->
        <div class="relative aspect-video bg-gray-900 rounded-2xl overflow-hidden shadow-2xl max-w-4xl mx-auto">
          {hasLivestream ? (
            <iframe
              src={embedUrl}
              class="w-full h-full"
              style="border: 0;"
              allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
              allowfullscreen
              title={`${eventDetails.event_name} Livestream`}
            ></iframe>
          ) : (
            <div class="absolute inset-0 flex flex-col items-center justify-center p-8 text-center">
              <svg class="w-24 h-24 text-white/20 mb-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z" />
              </svg>
              <h2 class="text-2xl md:text-3xl font-bold text-white mb-4">
                Livestream Coming Soon
              </h2>
              <p class="text-lg text-white/80 max-w-2xl mb-6">
                We'll share the livestream link closer to the event date. Check back here on the day of the ceremony to watch live!
              </p>
              <p class="text-sm text-white/60 font-mono">
                {eventDetails?.awards_ceremony ? new Date(eventDetails.awards_ceremony).toLocaleDateString('en-GB', { day: '2-digit', month: 'long', year: 'numeric' }) : '09 December 2025'}
              </p>
            </div>
          )}
        </div>

        {hasLivestream && (
          <div class="mt-8 text-center">
            <p class="text-sm text-white/70 font-mono">
              {eventDetails?.awards_ceremony ? new Date(eventDetails.awards_ceremony).toLocaleDateString('en-GB', { day: '2-digit', month: 'long', year: 'numeric' }) : '09 December 2025'}
            </p>
          </div>
        )}
      </div>
    </section>

    <!-- Event Information -->
    <section class="py-16 md:py-24 bg-white">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="text-center mb-12">
          <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-6">
            Join Us for the Biggest Night in XR
          </h2>
          <p class="text-lg text-gray-700 leading-relaxed">
            Can't make it to {eventDetails?.location || 'Brussels'} in person? No problem! Watch the ceremony live as we celebrate the best in virtual and augmented reality. See the winners announced, enjoy live entertainment, and be part of the global XR community.
          </p>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
          <div class="text-center">
            <div class="w-16 h-16 bg-[#4923EB] rounded-full flex items-center justify-center mx-auto mb-4">
              <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" />
              </svg>
            </div>
            <h3 class="text-lg font-bold text-gray-900 mb-2">Live Coverage</h3>
            <p class="text-sm text-gray-600">Real-time streaming of the entire ceremony from start to finish</p>
          </div>

          <div class="text-center">
            <div class="w-16 h-16 bg-[#E91E8C] rounded-full flex items-center justify-center mx-auto mb-4">
              <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z" />
              </svg>
            </div>
            <h3 class="text-lg font-bold text-gray-900 mb-2">Winner Announcements</h3>
            <p class="text-sm text-gray-600">Watch as winners take the stage to accept their trophies</p>
          </div>

          <div class="text-center">
            <div class="w-16 h-16 bg-[#00D4D8] rounded-full flex items-center justify-center mx-auto mb-4">
              <svg class="w-8 h-8 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z" />
              </svg>
            </div>
            <h3 class="text-lg font-bold text-gray-900 mb-2">Global Community</h3>
            <p class="text-sm text-gray-600">Join thousands of XR professionals watching worldwide</p>
          </div>
        </div>
      </div>
    </section>

    <!-- Sponsors Section -->
    {sponsors && sponsors.length > 0 && (
      <section class="py-16 md:py-24 bg-gray-50">
        <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="text-center mb-12">
            <p class="text-sm text-gray-600 font-mono mb-4">Thank you to our Sponsors & Partners</p>
          </div>
          
          <div class="grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 md:gap-8 items-center">
            {sponsors.map((sponsor) => (
              <div class="opacity-70 hover:opacity-100 transition-opacity flex items-center justify-center">
                {sponsor.logo_url ? (
                  <Image
                    src={sponsor.logo_url}
                    alt={sponsor.name}
                    class="max-h-12 w-auto object-contain"
                    width={120}
                    height={48}
                    loading="lazy"
                    format="webp"
                  />
                ) : (
                  <div class="h-10 w-20 bg-gray-300 rounded flex items-center justify-center text-xs">
                    {sponsor.name}
                  </div>
                )}
              </div>
            ))}
          </div>
        </div>
      </section>
    )}

    <!-- FAQ Section -->
    <section class="py-16 md:py-24 bg-white">
      <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <h2 class="text-2xl md:text-3xl font-bold text-gray-900 mb-12 text-center">Frequently Asked Questions</h2>
        
        <div class="space-y-4">
          <!-- FAQ 1 -->
          <details class="group rounded-lg border border-gray-200 bg-white">
            <summary class="flex items-center justify-between px-6 py-4 cursor-pointer list-none">
              <span class="text-lg font-semibold text-gray-900">How do I watch the XR Awards livestream?</span>
              <svg class="w-5 h-5 text-gray-500 transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </summary>
            <div class="px-6 pb-4 text-gray-700">
              <p>Simply visit this page on the day of the ceremony. The livestream will be embedded directly on this page, so you can watch without leaving our website. No registration or login required, just click and watch!</p>
            </div>
          </details>

          <!-- FAQ 2 -->
          <details class="group rounded-lg border border-gray-200 bg-white">
            <summary class="flex items-center justify-between px-6 py-4 cursor-pointer list-none">
              <span class="text-lg font-semibold text-gray-900">Where can I watch the XR Awards online?</span>
              <svg class="w-5 h-5 text-gray-500 transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </summary>
            <div class="px-6 pb-4 text-gray-700">
              <p>You can watch the XR Awards livestream right here on this page. We'll also stream on our YouTube and social media channels. Bookmark this page for the easiest viewing experience!</p>
            </div>
          </details>

          <!-- FAQ 3 -->
          <details class="group rounded-lg border border-gray-200 bg-white">
            <summary class="flex items-center justify-between px-6 py-4 cursor-pointer list-none">
              <span class="text-lg font-semibold text-gray-900">Is the XR Awards livestream free to watch?</span>
              <svg class="w-5 h-5 text-gray-500 transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </summary>
            <div class="px-6 pb-4 text-gray-700">
              <p>Yes! The livestream is completely free to watch. No tickets, registration, or subscription required. We want to make the XR Awards accessible to everyone in the global XR community.</p>
            </div>
          </details>

          <!-- FAQ 4 -->
          <details class="group rounded-lg border border-gray-200 bg-white">
            <summary class="flex items-center justify-between px-6 py-4 cursor-pointer list-none">
              <span class="text-lg font-semibold text-gray-900">Can I watch the XR Awards ceremony after it airs?</span>
              <svg class="w-5 h-5 text-gray-500 transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </summary>
            <div class="px-6 pb-4 text-gray-700">
              <p>Yes! The full ceremony recording will be available on-demand after the livestream ends. You can watch the replay anytime on this page or on our YouTube channel. All winner announcements and highlights will be preserved.</p>
            </div>
          </details>

          <!-- FAQ 5 -->
          <details class="group rounded-lg border border-gray-200 bg-white">
            <summary class="flex items-center justify-between px-6 py-4 cursor-pointer list-none">
              <span class="text-lg font-semibold text-gray-900">What time is the XR Awards ceremony livestream?</span>
              <svg class="w-5 h-5 text-gray-500 transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </summary>
            <div class="px-6 pb-4 text-gray-700">
              <p>The XR Awards ceremony takes place on {eventDetails?.awards_ceremony ? new Date(eventDetails.awards_ceremony).toLocaleDateString('en-GB', { day: '2-digit', month: 'long', year: 'numeric' }) : '09 December 2025'}. The exact livestream start time will be announced closer to the event date. Check back here or follow us on social media for updates.</p>
            </div>
          </details>

          <!-- FAQ 6 -->
          <details class="group rounded-lg border border-gray-200 bg-white">
            <summary class="flex items-center justify-between px-6 py-4 cursor-pointer list-none">
              <span class="text-lg font-semibold text-gray-900">How can I attend the XR Awards in person?</span>
              <svg class="w-5 h-5 text-gray-500 transition-transform group-open:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </summary>
            <div class="px-6 pb-4 text-gray-700 space-y-4">
              <p>Tickets for the in-person XR Awards Gala in {eventDetails?.location || 'Brussels'} can be purchased through United XR. Your ticket includes access to the drinks reception, sit-down dinner, awards ceremony, and after party. Experience the event live alongside industry leaders and innovators.</p>
              <a 
                href={eventDetails?.tickets_portal_url || 'https://events.unitedxr.eu/2025'}
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center px-6 py-2 bg-[#4923EB] text-white font-medium rounded-lg hover:bg-[#3a1bb8] transition-colors"
              >
                Get Tickets
              </a>
            </div>
          </details>
        </div>
      </div>
    </section>

    <!-- CTA Section -->
    <CTAFooter />
  </main>

  <Footer />
</Layout>

<style>
  .page-title {
    font-size: 35px;
    font-weight: 600;
  }

  .page-subtitle {
    font-size: 16px;
    font-weight: 300;
    font-family: "IBM Plex Mono", monospace;
  }

  /* Accordion styling */
  details summary::-webkit-details-marker {
    display: none;
  }

  details[open] {
    border-color: #4923EB;
  }
</style>


